
        <!DOCTYPE html>
        <html lang="en">
          <head>
            <meta charset="UTF-8" />
            <title>Error</title>
            <script type="module">
              const error = {"message":"C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\src\\ResearchAssistant.tsx: Unexpected token, expected \",\" (292:57)\n\n  290 |                                 steps: [...(task.steps || []), {\n  291 |                                     step_type: data.step_type,\n> 292 |                                     content: data.content\n      |                                                          ^","stack":"    at constructor (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:365:19)\n    at TypeScriptParserMixin.raise (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:6599:19)\n    at TypeScriptParserMixin.unexpected (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:6619:16)\n    at TypeScriptParserMixin.expect (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:6899:12)\n    at TypeScriptParserMixin.parseObjectLike (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:11822:14)\n    at TypeScriptParserMixin.parseExprAtom (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:11339:23)\n    at TypeScriptParserMixin.parseExprAtom (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:4764:20)\n    at TypeScriptParserMixin.parseExprSubscripts (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:11081:23)\n    at TypeScriptParserMixin.parseUpdate (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:11066:21)\n    at TypeScriptParserMixin.parseMaybeUnary (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:11046:23)\n    at TypeScriptParserMixin.parseMaybeUnary (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:9837:18)\n    at TypeScriptParserMixin.parseMaybeUnaryOrPrivate (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:10899:61)\n    at TypeScriptParserMixin.parseExprOps (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:10904:23)\n    at TypeScriptParserMixin.parseMaybeConditional (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:10881:23)\n    at TypeScriptParserMixin.parseMaybeAssign (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:10831:21)\n    at TypeScriptParserMixin.parseMaybeAssign (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:9786:20)\n    at C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:10800:39\n    at TypeScriptParserMixin.allowInAnd (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:12426:12)\n    at TypeScriptParserMixin.parseMaybeAssignAllowIn (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:10800:17)\n    at TypeScriptParserMixin.parseMaybeAssignAllowInOrVoidPattern (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:12493:17)\n    at TypeScriptParserMixin.parseExprListItem (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:12175:18)\n    at TypeScriptParserMixin.parseExprList (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:12150:22)\n    at TypeScriptParserMixin.parseArrayLike (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:12057:26)\n    at TypeScriptParserMixin.parseArrayLike (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:9193:24)\n    at TypeScriptParserMixin.parseExprAtom (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:11335:23)\n    at TypeScriptParserMixin.parseExprAtom (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:4764:20)\n    at TypeScriptParserMixin.parseExprSubscripts (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:11081:23)\n    at TypeScriptParserMixin.parseUpdate (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:11066:21)\n    at TypeScriptParserMixin.parseMaybeUnary (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:11046:23)\n    at TypeScriptParserMixin.parseMaybeUnary (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:9837:18)\n    at TypeScriptParserMixin.parseMaybeUnaryOrPrivate (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:10899:61)\n    at TypeScriptParserMixin.parseExprOps (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:10904:23)\n    at TypeScriptParserMixin.parseMaybeConditional (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:10881:23)\n    at TypeScriptParserMixin.parseMaybeAssign (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:10831:21)\n    at TypeScriptParserMixin.parseMaybeAssign (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:9786:20)\n    at C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:10800:39\n    at TypeScriptParserMixin.allowInAnd (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:12426:12)\n    at TypeScriptParserMixin.parseMaybeAssignAllowIn (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:10800:17)\n    at TypeScriptParserMixin.parseMaybeAssignAllowInOrVoidPattern (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:12493:17)\n    at TypeScriptParserMixin.parseObjectProperty (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:11950:83)\n    at TypeScriptParserMixin.parseObjPropValue (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:11978:100)\n    at TypeScriptParserMixin.parseObjPropValue (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:9744:18)\n    at TypeScriptParserMixin.parsePropertyDefinition (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:11915:17)\n    at TypeScriptParserMixin.parseObjectLike (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:11832:21)\n    at TypeScriptParserMixin.parseExprAtom (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:11339:23)\n    at TypeScriptParserMixin.parseExprAtom (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:4764:20)\n    at TypeScriptParserMixin.parseExprSubscripts (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:11081:23)\n    at TypeScriptParserMixin.parseUpdate (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:11066:21)\n    at TypeScriptParserMixin.parseMaybeUnary (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:11046:23)\n    at TypeScriptParserMixin.parseMaybeUnary (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:9837:18)","id":"C:/Users/Lin/Documents/trae_projects/AgentPaper/src/ResearchAssistant.tsx","frame":"290|                                  steps: [...(task.steps || []), {\n291|                                      step_type: data.step_type,\n292|                                      content: data.content\n   |                                                           ^","plugin":"vite:react-babel","pluginCode":"import { useState, useEffect, useRef } from 'react'\n\ninterface Paper {\n    paper_id: string\n    title: string\n    authors: string[]\n    year: number\n    abstract: string\n    url: string\n    pdf_url: string\n    source: string\n    citation_count: number\n    analysis?: {\n        contributions: string[]\n        methods: string[]\n        limitations: string[]\n        keywords: string[]\n    }\n}\n\ninterface Cluster {\n    name: string\n    papers: Paper[]\n    paper_count: number\n    keywords: string[]\n}\n\ninterface CrossPoint {\n    name: string\n    description: string\n    related_clusters: string[]\n    potential_methods: string[]\n}\n\ninterface ReportSection {\n    title: string\n    content: string\n    key_findings?: Array\u003c{ finding: string; paper: string; paper_id: string }>\n    references?: Array\u003c{ title: string; year: number }>\n}\n\ninterface ResearchResult {\n    success: boolean\n    topic: string\n    papers: Paper[]\n    clusters: Cluster[]\n    cross_points: CrossPoint[]\n    report: {\n        title: string\n        sections: ReportSection[]\n    }\n}\n\ninterface Progress {\n    state: string\n    progress: number\n    task: string\n}\n\ninterface Step {\n    type: 'thought' | 'action' | 'observation'\n    content: string\n    iteration: number\n    timestamp?: string\n}\n\ninterface TaskStep {\n    step_type: 'thought' | 'action' | 'observation'\n    content: string\n    timestamp: string\n}\n\ninterface ResearchTask {\n    task_id: string\n    name: string\n    description: string\n    status: 'pending' | 'in_progress' | 'completed' | 'failed'\n    steps?: TaskStep[]\n    start_time?: string\n    end_time?: string\n}\n\nexport function ResearchAssistant() {\n    const [topic, setTopic] = useState('')\n    const [years, setYears] = useState(2)\n    const [maxPapers, setMaxPapers] = useState(30)\n    const [loading, setLoading] = useState(false)\n    const [progress, setProgress] = useState\u003cProgress | null>(null)\n    const [steps, setSteps] = useState\u003cStep[]>([])\n    const [result, setResult] = useState\u003cResearchResult | null>(null)\n    const [error, setError] = useState\u003cstring | null>(null)\n    const [tasks, setTasks] = useState\u003cResearchTask[]>([])\n    const [expandedTasks, setExpandedTasks] = useState\u003cSet\u003cstring>>(new Set())\n    \n    const [selectedPaper, setSelectedPaper] = useState\u003cPaper | null>(null)\n    const [pdfUrl, setPdfUrl] = useState\u003cstring | null>(null)\n    \n    const wsRef = useRef\u003cWebSocket | null>(null)\n\n    useEffect(() => {\n        return () => {\n            if (wsRef.current) {\n                wsRef.current.close()\n            }\n        }\n    }, [])\n\n    const toggleTaskExpand = (taskId: string) => {\n        setExpandedTasks(prev => {\n            const newSet = new Set(prev)\n            if (newSet.has(taskId)) {\n                newSet.delete(taskId)\n            } else {\n                newSet.add(taskId)\n            }\n            return newSet\n        })\n    }\n\n    const downloadReportAsText = (result: ResearchResult) => {\n        let text = `${result.report?.title || '研究报告'}\\n\\n`\n        \n        result.report?.sections?.forEach(section => {\n            text += `\\n${section.title}\\n${'='.repeat(section.title.length)}\\n`\n            text += `${section.content}\\n`\n            \n            if (section.key_findings && section.key_findings.length > 0) {\n                text += '\\n主要发现:\\n'\n                section.key_findings.forEach(finding => {\n                    text += `  - ${finding.finding} [${finding.paper}]\\n`\n                })\n            }\n        })\n        \n        const blob = new Blob([text], { type: 'text/plain;charset=utf-8' })\n        const url = URL.createObjectURL(blob)\n        const a = document.createElement('a')\n        a.href = url\n        a.download = `${result.topic || 'research_report'}.txt`\n        document.body.appendChild(a)\n        a.click()\n        document.body.removeChild(a)\n        URL.revokeObjectURL(url)\n    }\n\n    const downloadReportAsMarkdown = (result: ResearchResult) => {\n        let md = `# ${result.report?.title || '研究报告'}\\n\\n`\n        \n        result.report?.sections?.forEach((section, idx) => {\n            md += `\\n## ${section.title}\\n\\n`\n            md += `${section.content}\\n`\n            \n            if (section.key_findings && section.key_findings.length > 0) {\n                md += '\\n### 主要发现\\n\\n'\n                section.key_findings.forEach(finding => {\n                    md += `- ${finding.finding} [${finding.paper}]\\n`\n                })\n            }\n        })\n        \n        md += '\\n---\\n\\n## 参考文献\\n\\n'\n        result.papers?.slice(0, 20).forEach((paper, idx) => {\n            md += `${idx + 1}. ${paper.title}. ${paper.authors?.join(', ')}. (${paper.year}). ${paper.source}.\\n`\n        })\n        \n        const blob = new Blob([md], { type: 'text/markdown;charset=utf-8' })\n        const url = URL.createObjectURL(blob)\n        const a = document.createElement('a')\n        a.href = url\n        a.download = `${result.topic || 'research_report'}.md`\n        document.body.appendChild(a)\n        a.click()\n        document.body.removeChild(a)\n        URL.revokeObjectURL(url)\n    }\n\n    const downloadReportAsHTML = (result: ResearchResult) => {\n        let html = `\u003c!DOCTYPE html>\n\u003chtml>\n\u003chead>\n    \u003cmeta charset=\"UTF-8\">\n    \u003ctitle>${result.report?.title || '研究报告'}\u003c/title>\n    \u003cstyle>\n        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }\n        h1 { color: #1a5fb4; border-bottom: 2px solid #1a5fb4; padding-bottom: 10px; }\n        h2 { color: #2c3e50; margin-top: 30px; }\n        h3 { color: #34495e; }\n        .finding { background: #f8f9fa; padding: 10px; border-left: 4px solid #1a5fb4; margin: 10px 0; }\n        .reference { font-size: 0.9em; color: #666; margin: 5px 0; }\n    \u003c/style>\n\u003c/head>\n\u003cbody>\n    \u003ch1>${result.report?.title || '研究报告'}\u003c/h1>`\n        \n        result.report?.sections?.forEach(section => {\n            html += `\n    \u003ch2>${section.title}\u003c/h2>\n    \u003cp>${section.content.replace(/\\n/g, '\u003cbr>')}\u003c/p>`\n            \n            if (section.key_findings && section.key_findings.length > 0) {\n                html += `\n    \u003ch3>主要发现\u003c/h3>`\n                section.key_findings.forEach(finding => {\n                    html += `\n    \u003cdiv class=\"finding\">${finding.finding} \u003cspan style=\"color: #1a5fb4;\">[${finding.paper}]\u003c/span>\u003c/div>`\n                })\n            }\n        })\n        \n        html += `\n    \u003ch2>参考文献\u003c/h2>`\n        result.papers?.slice(0, 20).forEach((paper, idx) => {\n            html += `\n    \u003cdiv class=\"reference\">${idx + 1}. ${paper.title}. ${paper.authors?.join(', ')}. (${paper.year}). ${paper.source}.\u003c/div>`\n        })\n        \n        html += `\n\u003c/body>\n\u003c/html>`\n        \n        const blob = new Blob([html], { type: 'text/html;charset=utf-8' })\n        const url = URL.createObjectURL(blob)\n        const a = document.createElement('a')\n        a.href = url\n        a.download = `${result.topic || 'research_report'}.html`\n        document.body.appendChild(a)\n        a.click()\n        document.body.removeChild(a)\n        URL.revokeObjectURL(url)\n    }\n\n    const startResearch = async () => {\n        if (!topic.trim()) return\n        \n        setLoading(true)\n        setError(null)\n        setResult(null)\n        setSteps([])\n        setTasks([])\n        setExpandedTasks(new Set())\n        setProgress({ state: 'searching', progress: 0, task: '正在初始化...' })\n\n        try {\n            const wsUrl = 'ws://localhost:8000/ws/research'\n            console.log('Connecting to:', wsUrl)\n            \n            const ws = new WebSocket(wsUrl)\n            wsRef.current = ws\n\n            ws.onopen = () => {\n                console.log('WebSocket connected')\n                ws.send(JSON.stringify({\n                    type: 'start_research',\n                    topic: topic.trim(),\n                    years,\n                    max_papers: maxPapers\n                }))\n            }\n\n            ws.onmessage = (event) => {\n                const data = JSON.parse(event.data)\n                if (data.type === 'progress') {\n                    setProgress(data)\n                } else if (data.type === 'step') {\n                    setSteps(prev => [...prev, {\n                        type: data.step_type,\n                        content: data.content,\n                        iteration: prev.length + 1,\n                        timestamp: new Date().toISOString()\n                    }])\n                } else if (data.type === 'task_list') {\n                    setTasks(data.tasks)\n                    setSteps(prev => [...prev, {\n                        type: 'thought',\n                        content: '已规划研究任务列表',\n                        iteration: prev.length + 1,\n                        timestamp: new Date().toISOString()\n                    }])\n                } else if (data.type === 'task_update') {\n                    setTasks(prev => prev.map(task => \n                        task.task_id === data.task_id \n                            ? { ...task, status: data.status }\n                            : task\n                    ))\n                } else if (data.type === 'task_step') {\n                    setTasks(prev => prev.map(task => {\n                        if (task.task_id === data.task_id) {\n                            return {\n                                ...task,\n                                steps: [...(task.steps || []), {\n                                    step_type: data.step_type,\n                                    content: data.content","loc":{"line":292,"column":57,"index":9492}}
              try {
                const { ErrorOverlay } = await import("/@vite/client")
                document.body.appendChild(new ErrorOverlay(error))
              } catch {
                const h = (tag, text) => {
                  const el = document.createElement(tag)
                  el.textContent = text
                  return el
                }
                document.body.appendChild(h('h1', 'Internal Server Error'))
                document.body.appendChild(h('h2', error.message))
                document.body.appendChild(h('pre', error.stack))
                document.body.appendChild(h('p', '(Error overlay failed to load)'))
              }
            </script>
          </head>
          <body>
          </body>
        </html>
      