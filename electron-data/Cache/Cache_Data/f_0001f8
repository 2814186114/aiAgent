
        <!DOCTYPE html>
        <html lang="en">
          <head>
            <meta charset="UTF-8" />
            <title>Error</title>
            <script type="module">
              const error = {"message":"C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\src\\App.tsx: Expected corresponding JSX closing tag for \u003cdiv>. (803:16)\n\n  801 |                     \u003cVisualizationDashboard />\n  802 |                         ) : null}\n> 803 |                 \u003c/main>\n      |                 ^\n  804 |\n  805 |                 {activeTab === 'chat' && (\n  806 |                     \u003cfooter className=\"chat-input-container flex-shrink-0\">","stack":"    at constructor (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:365:19)\n    at TypeScriptParserMixin.raise (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:6599:19)\n    at TypeScriptParserMixin.jsxParseElementAt (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:4727:16)\n    at TypeScriptParserMixin.jsxParseElementAt (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:4698:32)\n    at TypeScriptParserMixin.jsxParseElementAt (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:4698:32)\n    at TypeScriptParserMixin.jsxParseElement (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:4749:17)\n    at TypeScriptParserMixin.parseExprAtom (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:4759:19)\n    at TypeScriptParserMixin.parseExprSubscripts (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:11081:23)\n    at TypeScriptParserMixin.parseUpdate (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:11066:21)\n    at TypeScriptParserMixin.parseMaybeUnary (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:11046:23)\n    at TypeScriptParserMixin.parseMaybeUnary (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:9837:18)\n    at TypeScriptParserMixin.parseMaybeUnaryOrPrivate (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:10899:61)\n    at TypeScriptParserMixin.parseExprOps (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:10904:23)\n    at TypeScriptParserMixin.parseMaybeConditional (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:10881:23)\n    at TypeScriptParserMixin.parseMaybeAssign (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:10831:21)\n    at C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:9775:39\n    at TypeScriptParserMixin.tryParse (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:6907:20)\n    at TypeScriptParserMixin.parseMaybeAssign (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:9775:18)\n    at C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:10800:39\n    at TypeScriptParserMixin.allowInAnd (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:12426:12)\n    at TypeScriptParserMixin.parseMaybeAssignAllowIn (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:10800:17)\n    at TypeScriptParserMixin.parseMaybeAssignAllowInOrVoidPattern (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:12493:17)\n    at TypeScriptParserMixin.parseParenAndDistinguishExpression (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:11675:28)\n    at TypeScriptParserMixin.parseExprAtom (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:11331:23)\n    at TypeScriptParserMixin.parseExprAtom (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:4764:20)\n    at TypeScriptParserMixin.parseExprSubscripts (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:11081:23)\n    at TypeScriptParserMixin.parseUpdate (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:11066:21)\n    at TypeScriptParserMixin.parseMaybeUnary (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:11046:23)\n    at TypeScriptParserMixin.parseMaybeUnary (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:9837:18)\n    at TypeScriptParserMixin.parseMaybeUnaryOrPrivate (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:10899:61)\n    at TypeScriptParserMixin.parseExprOps (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:10904:23)\n    at TypeScriptParserMixin.parseMaybeConditional (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:10881:23)\n    at TypeScriptParserMixin.parseMaybeAssign (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:10831:21)\n    at TypeScriptParserMixin.parseMaybeAssign (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:9786:20)\n    at TypeScriptParserMixin.parseExpressionBase (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:10784:23)\n    at C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:10780:39\n    at TypeScriptParserMixin.allowInAnd (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:12421:16)\n    at TypeScriptParserMixin.parseExpression (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:10780:17)\n    at TypeScriptParserMixin.parseReturnStatement (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:13142:28)\n    at TypeScriptParserMixin.parseStatementContent (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:12798:21)\n    at TypeScriptParserMixin.parseStatementContent (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:9508:18)\n    at TypeScriptParserMixin.parseStatementLike (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:12767:17)\n    at TypeScriptParserMixin.parseStatementListItem (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:12747:17)\n    at TypeScriptParserMixin.parseBlockOrModuleBlockBody (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:13316:61)\n    at TypeScriptParserMixin.parseBlockBody (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:13309:10)\n    at TypeScriptParserMixin.parseBlock (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:13297:10)\n    at TypeScriptParserMixin.parseFunctionBody (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:12100:24)\n    at TypeScriptParserMixin.parseFunctionBodyAndFinish (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:12086:10)\n    at TypeScriptParserMixin.parseFunctionBodyAndFinish (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:9172:18)\n    at C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:13445:12","id":"C:/Users/Lin/Documents/trae_projects/AgentPaper/src/App.tsx","frame":"813|                                          ? 'bg-primary-500 text-white shadow-md'\n814|                                          : 'bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600'\n815|                                          }`}\n   |                            ^\n816|                                  >\n817|                                      {action.icon} {action.label}","plugin":"vite:react-babel","pluginCode":"import { useState, useEffect, useRef, useCallback } from 'react'\r\nimport { io, Socket } from 'socket.io-client'\r\nimport { PPTGenerator } from './PPTGenerator'\r\nimport { EnhancedStepCard } from './EnhancedStepCard'\r\nimport { TaskSidebar } from './TaskSidebar'\r\nimport { LiteratureManager } from './LiteratureManager'\r\nimport { LiteratureReview } from './LiteratureReview'\r\nimport { ResearchAssistant } from './ResearchAssistant'\r\nimport { ExperimentManager } from './ExperimentManager'\r\nimport { UnifiedAssistant } from './UnifiedAssistant'\r\nimport { VisualizationDashboard } from './VisualizationDashboard'\r\nimport { AuthProvider, useAuth } from './contexts/AuthContext'\r\nimport { LoginModal } from './components/LoginModal'\r\n\r\ninterface Paper {\r\n    title: string\r\n    authors: string[]\r\n    year?: number\r\n    abstract?: string\r\n    url?: string\r\n    pdf_url?: string\r\n}\r\n\r\ninterface Experiment {\r\n    id: number\r\n    timestamp: string\r\n    model?: string\r\n    dataset?: string\r\n    metric?: string\r\n    value?: number\r\n    notes?: string\r\n}\r\n\r\ninterface ToolResult {\r\n    success?: boolean\r\n    papers?: Paper[]\r\n    experiments?: Experiment[]\r\n    message?: string\r\n    error?: string\r\n    total_pages?: number\r\n    summary?: string\r\n    save_path?: string\r\n    file_size?: number\r\n    data?: any\r\n    id?: number\r\n    total?: number\r\n}\r\n\r\ninterface AgentStep {\r\n    type: 'thought' | 'action' | 'observation' | 'error' | 'answer'\r\n    content?: string\r\n    tool?: string\r\n    arguments?: Record\u003cstring, unknown>\r\n    tool_result?: ToolResult\r\n    iteration: number\r\n}\r\n\r\ninterface Message {\r\n    id: string\r\n    content: string\r\n    sender: 'user' | 'agent'\r\n    timestamp: Date\r\n    steps?: AgentStep[]\r\n    isComplete?: boolean\r\n    taskId?: string\r\n}\r\n\r\nconst SOCKET_URL = 'http://localhost:3001'\r\n\r\ntype Tab = 'unified'\r\ntype InputMode = 'chat' | 'record' | 'query'\r\n\r\ninterface QuickAction {\r\n    id: string\r\n    label: string\r\n    icon: string\r\n    mode: InputMode\r\n    prefix: string\r\n    placeholder: string\r\n}\r\n\r\nconst QUICK_ACTIONS: QuickAction[] = [\r\n    { id: 'chat', label: 'å¯¹è¯', icon: 'ðŸ’¬', mode: 'chat', prefix: '', placeholder: 'æé—®ã€æœç´¢è®ºæ–‡ã€åˆ†æžé—®é¢˜...' },\r\n    { id: 'experiment', label: 'è®°å½•å®žéªŒ', icon: 'ðŸ§ª', mode: 'record', prefix: '/å®žéªŒ ', placeholder: 'æè¿°ä½ çš„å®žéªŒç»“æžœï¼Œå¦‚ï¼šBERTåœ¨SST-2ä¸Šå‡†ç¡®çŽ‡92.3%' },\r\n    { id: 'reminder', label: 'æ·»åŠ æ—¥ç¨‹', icon: 'ðŸ“…', mode: 'record', prefix: '/æ—¥ç¨‹ ', placeholder: 'æè¿°ä½ çš„æ—¥ç¨‹ï¼Œå¦‚ï¼šæ˜Žå¤©ä¸‹åˆ3ç‚¹ç»„ä¼š' },\r\n    { id: 'query', label: 'æŸ¥è¯¢è®°å½•', icon: 'ðŸ”', mode: 'query', prefix: '/æŸ¥è¯¢ ', placeholder: 'æŸ¥è¯¢åŽ†å²ï¼Œå¦‚ï¼šæœ€è¿‘çš„BERTå®žéªŒ' },\r\n]\r\n\r\nfunction AppContent() {\r\n    const { user, logout } = useAuth()\r\n    const [showLoginModal, setShowLoginModal] = useState(false)\r\n    const [activeTab, setActiveTab] = useState\u003cTab>('unified')\r\n    const [showSidebar, setShowSidebar] = useState(true)\r\n    const [messages, setMessages] = useState\u003cMessage[]>([])\r\n    const [inputValue, setInputValue] = useState('')\r\n    const [inputMode, setInputMode] = useState\u003cInputMode>('chat')\r\n    const [showModeHint, setShowModeHint] = useState(false)\r\n    const [detectedMode, setDetectedMode] = useState\u003c{ mode: InputMode; hint: string } | null>(null)\r\n    const [isConnected, setIsConnected] = useState(false)\r\n    const [isProcessing, setIsProcessing] = useState(false)\r\n    const [currentSteps, setCurrentSteps] = useState\u003cAgentStep[]>([])\r\n    const [currentAnswer, setCurrentAnswer] = useState\u003cstring | null>(null)\r\n    const [selectedTaskId, setSelectedTaskId] = useState\u003cstring | undefined>()\r\n    const [chatMode, setChatMode] = useState\u003c'normal' | 'planning'>('normal')\r\n    const [planTasks, setPlanTasks] = useState\u003cany[]>([])\r\n    const [expandedPlanTasks, setExpandedPlanTasks] = useState\u003cSet\u003cstring>>(new Set())\r\n    const [planningProgress, setPlanningProgress] = useState\u003cany | null>(null)\r\n    const [planningSteps, setPlanningSteps] = useState\u003cany[]>([])\r\n    const [planningLoading, setPlanningLoading] = useState(false)\r\n    const [planningError, setPlanningError] = useState\u003cstring | null>(null)\r\n    const messagesEndRef = useRef\u003cHTMLDivElement>(null)\r\n    const socketRef = useRef\u003cSocket | null>(null)\r\n    const planningWsRef = useRef\u003cWebSocket | null>(null)\r\n    const reconnectTimeoutRef = useRef\u003cNodeJS.Timeout | null>(null)\r\n\r\n    const saveTask = async (taskId: string, task: string, answer: string | null, steps: AgentStep[]) => {\r\n        try {\r\n            await fetch('http://localhost:8000/tasks', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({\r\n                    task_id: taskId,\r\n                    task,\r\n                    answer,\r\n                    steps\r\n                })\r\n            })\r\n        } catch (e) {\r\n            console.error('Failed to save task:', e)\r\n        }\r\n    }\r\n\r\n    const loadTask = async (taskId: string) => {\r\n        try {\r\n            const response = await fetch(`http://localhost:8000/tasks/${taskId}`)\r\n            const data = await response.json()\r\n            if (data.success && data.task) {\r\n                const task = data.task\r\n                const message: Message = {\r\n                    id: task.id,\r\n                    content: task.task,\r\n                    sender: 'user',\r\n                    timestamp: new Date(task.created_at)\r\n                }\r\n                const answerMessage: Message = {\r\n                    id: task.id + '-answer',\r\n                    content: task.answer || '',\r\n                    sender: 'agent',\r\n                    timestamp: new Date(task.updated_at),\r\n                    steps: task.steps,\r\n                    isComplete: true,\r\n                    taskId: task.id\r\n                }\r\n                setMessages([message, answerMessage])\r\n                setSelectedTaskId(taskId)\r\n            }\r\n        } catch (e) {\r\n            console.error('Failed to load task:', e)\r\n        }\r\n    }\r\n\r\n    const connectSocket = useCallback(() => {\r\n        if (socketRef.current?.connected) return\r\n\r\n        socketRef.current = io(SOCKET_URL, {\r\n            transports: ['websocket', 'polling'],\r\n            reconnection: true,\r\n            reconnectionAttempts: 10,\r\n            reconnectionDelay: 1000,\r\n        })\r\n\r\n        const socket = socketRef.current\r\n\r\n        socket.on('connect', () => {\r\n            console.log('Connected to server')\r\n            setIsConnected(true)\r\n        })\r\n\r\n        socket.on('disconnect', () => {\r\n            console.log('Disconnected from server')\r\n            setIsConnected(false)\r\n        })\r\n\r\n        socket.on('connection-status', (data) => {\r\n            console.log('Connection status:', data)\r\n        })\r\n\r\n        socket.on('agent-step', (step: AgentStep) => {\r\n            console.log('Agent step:', step)\r\n            setCurrentSteps(prev => [...prev, step])\r\n        })\r\n\r\n        socket.on('agent-complete', (data: { answer: string; total_steps: number; iterations: number }) => {\r\n            console.log('Agent complete:', data)\r\n            setCurrentAnswer(data.answer)\r\n            setIsProcessing(false)\r\n        })\r\n\r\n        socket.on('agent-error', (data: { message: string }) => {\r\n            console.error('Agent error:', data)\r\n            setCurrentSteps(prev => [...prev, {\r\n                type: 'error',\r\n                content: data.message,\r\n                iteration: prev.length + 1\r\n            }])\r\n            setIsProcessing(false)\r\n        })\r\n\r\n        socket.on('connect_error', (err) => {\r\n            console.error('Connection error:', err)\r\n            if (!reconnectTimeoutRef.current) {\r\n                reconnectTimeoutRef.current = setTimeout(() => {\r\n                    reconnectTimeoutRef.current = null\r\n                    connectSocket()\r\n                }, 3000)\r\n            }\r\n        })\r\n    }, [])\r\n\r\n    useEffect(() => {\r\n        connectSocket()\r\n\r\n        return () => {\r\n            if (reconnectTimeoutRef.current) {\r\n                clearTimeout(reconnectTimeoutRef.current)\r\n            }\r\n            socketRef.current?.disconnect()\r\n        }\r\n    }, [connectSocket])\r\n\r\n    useEffect(() => {\r\n        messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' })\r\n    }, [messages, currentSteps, currentAnswer])\r\n\r\n    useEffect(() => {\r\n        if (currentAnswer && currentSteps.length > 0 && !isProcessing) {\r\n            const lastUserMessage = [...messages].reverse().find(m => m.sender === 'user')\r\n            if (lastUserMessage) {\r\n                const taskId = Date.now().toString()\r\n                const agentMessage: Message = {\r\n                    id: Date.now().toString(),\r\n                    content: currentAnswer,\r\n                    sender: 'agent',\r\n                    timestamp: new Date(),\r\n                    steps: currentSteps,\r\n                    isComplete: true,\r\n                    taskId\r\n                }\r\n                setMessages(prev => [...prev, agentMessage])\r\n                setCurrentSteps([])\r\n                setCurrentAnswer(null)\r\n\r\n                saveTask(taskId, lastUserMessage.content, currentAnswer, currentSteps)\r\n            }\r\n        }\r\n    }, [currentAnswer, currentSteps, isProcessing, messages])\r\n\r\n    const detectInputMode = (text: string): { mode: InputMode; hint: string; processedText: string } => {\r\n        const lowerText = text.toLowerCase().trim()\r\n\r\n        if (lowerText.startsWith('/å®žéªŒ') || lowerText.startsWith('/experiment')) {\r\n            return {\r\n                mode: 'record',\r\n                hint: 'å°†è®°å½•ä¸ºå®žéªŒç»“æžœ',\r\n                processedText: text.replace(/^\\/å®žéªŒ\\s*/i, '').replace(/^\\/experiment\\s*/i, '')\r\n            }\r\n        }\r\n        if (lowerText.startsWith('/æ—¥ç¨‹') || lowerText.startsWith('/æé†’') || lowerText.startsWith('/reminder')) {\r\n            return {\r\n                mode: 'record',\r\n                hint: 'å°†æ·»åŠ ä¸ºæ—¥ç¨‹æé†’',\r\n                processedText: text.replace(/^\\/æ—¥ç¨‹\\s*/i, '').replace(/^\\/æé†’\\s*/i, '').replace(/^\\/reminder\\s*/i, '')\r\n            }\r\n        }\r\n        if (lowerText.startsWith('/æŸ¥è¯¢') || lowerText.startsWith('/query')) {\r\n            return {\r\n                mode: 'query',\r\n                hint: 'å°†æŸ¥è¯¢åŽ†å²è®°å½•',\r\n                processedText: text.replace(/^\\/æŸ¥è¯¢\\s*/i, '').replace(/^\\/query\\s*/i, '')\r\n            }\r\n        }\r\n\r\n        const experimentKeywords = ['è·‘äº†', 'æµ‹è¯•äº†', 'å®žéªŒç»“æžœ', 'å‡†ç¡®çŽ‡', 'loss', 'ç²¾åº¦', 'f1', 'recall', 'precision', 'è®­ç»ƒäº†', 'æ¨¡åž‹åœ¨', 'æ•°æ®é›†ä¸Š']\r\n        const reminderKeywords = ['æé†’æˆ‘', 'åˆ«å¿˜äº†', 'è®°å¾—', 'æ˜Žå¤©', 'ä¸‹å‘¨', 'ä»Šå¤©ä¸‹åˆ', 'ä»Šå¤©ä¸Šåˆ', 'ç»„ä¼š', 'å¼€ä¼š', 'æˆªæ­¢', 'æäº¤']\r\n        const queryKeywords = ['æŸ¥çœ‹', 'æŸ¥è¯¢', 'æœ€è¿‘', 'åŽ†å²', 'æ‰€æœ‰å®žéªŒ', 'æ‰€æœ‰æ—¥ç¨‹', 'æ‰¾ä¸€ä¸‹', 'æœ‰æ²¡æœ‰']\r\n\r\n        for (const keyword of experimentKeywords) {\r\n            if (lowerText.includes(keyword)) {\r\n                return { mode: 'record', hint: `æ£€æµ‹åˆ°å®žéªŒå…³é”®è¯\"${keyword}\"ï¼Œå°†è®°å½•ä¸ºå®žéªŒ`, processedText: text }\r\n            }\r\n        }\r\n\r\n        for (const keyword of reminderKeywords) {\r\n            if (lowerText.includes(keyword)) {\r\n                return { mode: 'record', hint: `æ£€æµ‹åˆ°æ—¥ç¨‹å…³é”®è¯\"${keyword}\"ï¼Œå°†æ·»åŠ ä¸ºæé†’`, processedText: text }\r\n            }\r\n        }\r\n\r\n        for (const keyword of queryKeywords) {\r\n            if (lowerText.includes(keyword)) {\r\n                return { mode: 'query', hint: `æ£€æµ‹åˆ°æŸ¥è¯¢å…³é”®è¯\"${keyword}\"ï¼Œå°†æŸ¥è¯¢åŽ†å²`, processedText: text }\r\n            }\r\n        }\r\n\r\n        return { mode: 'chat', hint: 'å°†ä½œä¸ºå¯¹è¯å¤„ç†', processedText: text }\r\n    }\r\n\r\n    const handleInputChange = (value: string) => {\r\n        setInputValue(value)\r\n        if (value.trim()) {\r\n            const detected = detectInputMode(value)\r\n            setDetectedMode(detected)\r\n            setShowModeHint(true)\r\n        } else {\r\n            setShowModeHint(false)\r\n            setDetectedMode(null)\r\n        }\r\n    }\r\n\r\n    const handleQuickAction = (action: QuickAction) => {\r\n        setInputMode(action.mode)\r\n        if (!inputValue.startsWith(action.prefix)) {\r\n            setInputValue(action.prefix)\r\n        }\r\n        setShowModeHint(false)\r\n        setDetectedMode({ mode: action.mode, hint: action.label })\r\n    }\r\n\r\n    const handleSendMessage = async () => {\r\n        if (!inputValue.trim() || isProcessing || planningLoading) return\r\n\r\n        const detected = detectInputMode(inputValue)\r\n        let finalMessage = inputValue.trim()\r\n\r\n        if (detected.mode === 'record') {\r\n            if (inputValue.toLowerCase().includes('å®žéªŒ') ||\r\n                inputValue.toLowerCase().includes('å‡†ç¡®çŽ‡') ||\r\n                inputValue.toLowerCase().includes('loss') ||\r\n                inputValue.toLowerCase().includes('è®­ç»ƒ') ||\r\n                inputValue.toLowerCase().includes('æµ‹è¯•')) {\r\n                finalMessage = `è¯·å¸®æˆ‘è®°å½•å®žéªŒï¼š${detected.processedText}`\r\n            } else if (inputValue.toLowerCase().includes('æé†’') ||\r\n                inputValue.toLowerCase().includes('æ˜Žå¤©') ||\r\n                inputValue.toLowerCase().includes('ä¸‹å‘¨') ||\r\n                inputValue.toLowerCase().includes('ç»„ä¼š')) {\r\n                finalMessage = `è¯·å¸®æˆ‘æ·»åŠ æ—¥ç¨‹ï¼š${detected.processedText}`\r\n            }\r\n        } else if (detected.mode === 'query') {\r\n            finalMessage = `è¯·å¸®æˆ‘æŸ¥è¯¢ï¼š${detected.processedText}`\r\n        }\r\n\r\n        const userMessage: Message = {\r\n            id: Date.now().toString(),\r\n            content: inputValue.trim(),\r\n            sender: 'user',\r\n            timestamp: new Date(),\r\n        }\r\n\r\n        setMessages(prev => [...prev, userMessage])\r\n        setShowModeHint(false)\r\n        setDetectedMode(null)\r\n        setPlanTasks([])\r\n        setPlanningSteps([])\r\n        setPlanningProgress(null)\r\n        setPlanningError(null)\r\n        setExpandedPlanTasks(new Set())\r\n\r\n        if (chatMode === 'planning') {\r\n            setPlanningLoading(true)\r\n            setIsProcessing(true)\r\n\r\n            try {\r\n                const wsUrl = 'ws://localhost:8000/ws/planning'\r\n                console.log('Connecting to:', wsUrl)\r\n\r\n                const ws = new WebSocket(wsUrl)\r\n                planningWsRef.current = ws\r\n\r\n                ws.onopen = () => {\r\n                    console.log('Planning WebSocket connected')\r\n                    ws.send(JSON.stringify({\r\n                        type: 'start_planning',\r\n                        task: finalMessage\r\n                    }))\r\n                }\r\n\r\n                ws.onmessage = (event) => {\r\n                    const data = JSON.parse(event.data)\r\n                    if (data.type === 'progress') {\r\n                        setPlanningProgress(data)\r\n                    } else if (data.type === 'step') {\r\n                        setPlanningSteps(prev => [...prev, {\r\n                            type: data.step_type,\r\n                            content: data.content,\r\n                            iteration: prev.length + 1,\r\n                            timestamp: new Date().toISOString()\r\n                        }])\r\n                    } else if (data.type === 'task_list') {\r\n                        setPlanTasks(data.tasks)\r\n                        setPlanningSteps(prev => [...prev, {\r\n                            type: 'thought',\r\n                            content: 'å·²è§„åˆ’ä»»åŠ¡åˆ—è¡¨',\r\n                            iteration: prev.length + 1,\r\n                            timestamp: new Date().toISOString()\r\n                        }])\r\n                    } else if (data.type === 'task_update') {\r\n                        setPlanTasks(prev => prev.map(task =>\r\n                            task.task_id === data.task_id\r\n                                ? { ...task, status: data.status }\r\n                                : task\r\n                        ))\r\n                    } else if (data.type === 'task_step') {\r\n                        setPlanTasks(prev => prev.map(task => {\r\n                            if (task.task_id === data.task_id) {\r\n                                return {\r\n                                    ...task,\r\n                                    steps: [...(task.steps || []), {\r\n                                        step_type: data.step_type,\r\n                                        content: data.content,\r\n                                        timestamp: data.timestamp\r\n                                    }]\r\n                                }\r\n                            }\r\n                            return task\r\n                        }))\r\n                    } else if (data.type === 'complete') {\r\n                        const result = data.result\r\n                        if (result.plan) {\r\n                            setPlanTasks(result.plan)\r\n                        }\r\n\r\n                        const agentMessage: Message = {\r\n                            id: Date.now().toString(),\r\n                            content: result.final_answer || 'ä»»åŠ¡å®Œæˆï¼',\r\n                            sender: 'agent',\r\n                            timestamp: new Date(),\r\n                            steps: planningSteps,\r\n                            isComplete: true,\r\n                            taskId: Date.now().toString()\r\n                        }\r\n                        setMessages(prev => [...prev, agentMessage])\r\n                        setPlanningLoading(false)\r\n                        setIsProcessing(false)\r\n                        setCurrentSteps([])\r\n                        setCurrentAnswer(null)\r\n\r\n                        saveTask(agentMessage.taskId!, userMessage.content, agentMessage.content, planningSteps)\r\n                        ws.close()\r\n                    } else if (data.type === 'error') {\r\n                        setPlanningError(data.error)\r\n                        setPlanningSteps(prev => [...prev, {\r\n                            type: 'observation',\r\n                            content: `é”™è¯¯: ${data.error}`,\r\n                            iteration: prev.length + 1,\r\n                            timestamp: new Date().toISOString()\r\n                        }])\r\n                        setPlanningLoading(false)\r\n                        setIsProcessing(false)\r\n                        const errorMessage: Message = {\r\n                            id: Date.now().toString(),\r\n                            content: `æŠ±æ­‰ï¼Œå¤„ç†æ‚¨çš„è¯·æ±‚æ—¶é‡åˆ°äº†é—®é¢˜ï¼š${data.error}`,\r\n                            sender: 'agent',\r\n                            timestamp: new Date(),\r\n                        }\r\n                        setMessages(prev => [...prev, errorMessage])\r\n                        ws.close()\r\n                    }\r\n                }\r\n\r\n                ws.onerror = (event) => {\r\n                    console.error('WebSocket error:', event)\r\n                    setPlanningError('WebSocketè¿žæŽ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥åŽç«¯æœåŠ¡æ˜¯å¦å¯åŠ¨')\r\n                    setPlanningLoading(false)\r\n                    setIsProcessing(false)\r\n                }\r\n\r\n                ws.onclose = (event) => {\r\n                    console.log('WebSocket closed:', event.code, event.reason)\r\n                }\r\n\r\n            } catch (e: any) {\r\n                console.error('Error:', e)\r\n                setPlanningError(e.message || 'è¿žæŽ¥é”™è¯¯')\r\n                setPlanningLoading(false)\r\n                setIsProcessing(false)\r\n                const errorMessage: Message = {\r\n                    id: Date.now().toString(),\r\n                    content: 'æŠ±æ­‰ï¼Œå¤„ç†æ‚¨çš„è¯·æ±‚æ—¶é‡åˆ°äº†é—®é¢˜ã€‚è¯·é‡è¯•ã€‚',\r\n                    sender: 'agent',\r\n                    timestamp: new Date(),\r\n                }\r\n                setMessages(prev => [...prev, errorMessage])\r\n            }\r\n        } else {\r\n            setIsProcessing(true)\r\n            setCurrentSteps([])\r\n            setCurrentAnswer(null)\r\n            setSelectedTaskId(undefined)\r\n            socketRef.current?.emit('user-message', {\r\n                message: finalMessage,\r\n            })\r\n        }\r\n\r\n        setInputValue('')\r\n    }\r\n\r\n    const handleKeyPress = (e: React.KeyboardEvent\u003cHTMLInputElement>) => {\r\n        if (e.key === 'Enter' && !e.shiftKey) {\r\n            e.preventDefault()\r\n            handleSendMessage()\r\n        }\r\n    }\r\n\r\n    const getCurrentPlaceholder = () => {\r\n        const action = QUICK_ACTIONS.find(a => a.mode === inputMode)\r\n        return action?.placeholder || 'è¾“å…¥ä½ çš„å­¦æœ¯ä»»åŠ¡...'\r\n    }\r\n\r\n    return (\r\n        \u003cdiv className=\"min-h-screen bg-gray-100 dark:bg-gray-900 flex\">\r\n            {showSidebar && activeTab === 'chat' && (\r\n                \u003cTaskSidebar\r\n                    onSelectTask={loadTask}\r\n                    selectedTaskId={selectedTaskId}\r\n                />\r\n            )}\r\n\r\n            \u003cdiv className=\"flex-1 flex flex-col\">\r\n                \u003cdiv className=\"chat-container flex flex-col h-screen\">\r\n                    \u003cheader className=\"chat-header flex-shrink-0\">\r\n                        \u003cdiv className=\"flex items-center justify-between mb-4\">\r\n                            \u003cdiv className=\"flex items-center gap-3\">\r\n                                {activeTab === 'chat' && (\r\n                                    \u003cbutton\r\n                                        onClick={() => setShowSidebar(!showSidebar)}\r\n                                        className=\"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700\"\r\n                                    >\r\n                                        {showSidebar ? 'â—€ï¸' : 'â–¶ï¸'}\r\n                                    \u003c/button>\r\n                                )}\r\n                                \u003ch1 className=\"text-2xl font-bold\">Academic Assistant Agent\u003c/h1>\r\n                            \u003c/div>\r\n                            \u003cdiv className=\"flex items-center gap-2\">\r\n                                \u003cspan className={`w-3 h-3 rounded-full ${isConnected ? 'bg-green-400' : 'bg-red-400'}`}>\u003c/span>\r\n                                \u003cspan className=\"text-sm\">{isConnected ? 'å·²è¿žæŽ¥' : 'æœªè¿žæŽ¥'}\u003c/span>\r\n                            \u003c/div>\r\n                            \u003cdiv className=\"flex items-center gap-3 ml-4\">\r\n                                {user ? (\r\n                                    \u003cdiv className=\"flex items-center gap-2\">\r\n                                        \u003cspan className=\"text-sm text-gray-600 dark:text-gray-300\">\r\n                                            ðŸ‘¤ {user.username}\r\n                                        \u003c/span>\r\n                                        \u003cbutton\r\n                                            onClick={logout}\r\n                                            className=\"px-3 py-1 text-sm bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300 rounded hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors\"\r\n                                        >\r\n                                            ç™»å‡º\r\n                                        \u003c/button>\r\n                                    \u003c/div>\r\n                                ) : (\r\n                                    \u003cbutton\r\n                                        onClick={() => setShowLoginModal(true)}\r\n                                        className=\"px-3 py-1 text-sm bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors\"\r\n                                    >\r\n                                        ç™»å½•\r\n                                    \u003c/button>\r\n                                )}\r\n                            \u003c/div>\r\n                        \u003c/div>\r\n                    \u003c/header>\r\n\r\n                    \u003cmain className=\"chat-messages flex-1 overflow-y-auto\">\r\n                        \u003cUnifiedAssistant />\r\n                    \u003c/main>\r\n                    \u003cdiv className=\"h-full overflow-y-auto\">\r\n                        {messages.length === 0 && !isProcessing && (\r\n                            \u003cdiv className=\"flex items-center justify-center h-full text-gray-500 dark:text-gray-400\">\r\n                                \u003cdiv className=\"text-center max-w-lg\">\r\n                                    \u003cdiv className=\"text-6xl mb-4\">ðŸŽ“\u003c/div>\r\n                                    \u003ch2 className=\"text-2xl font-bold text-gray-800 dark:text-white mb-2\">å­¦æœ¯åŠ©æ‰‹æ™ºèƒ½ä½“\u003c/h2>\r\n                                    \u003cp className=\"text-sm mb-6 text-gray-600 dark:text-gray-400\">\r\n                                        å¸®åŠ©ä½ å®Œæˆæ–‡çŒ®è°ƒç ”ã€å®žéªŒè®°å½•ã€æ—¥ç¨‹ç®¡ç†ç­‰å­¦æœ¯ä»»åŠ¡\r\n                                    \u003c/p>\r\n\r\n                                    \u003cdiv className=\"grid grid-cols-1 md:grid-cols-3 gap-3 mb-6\">\r\n                                        \u003cdiv className=\"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700\">\r\n                                            \u003cdiv className=\"text-2xl mb-2\">ðŸ’¬\u003c/div>\r\n                                            \u003ch3 className=\"font-medium text-gray-800 dark:text-white text-sm\">å¯¹è¯é—®ç­”\u003c/h3>\r\n                                            \u003cp className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">æœç´¢è®ºæ–‡ã€åˆ†æžé—®é¢˜\u003c/p>\r\n                                        \u003c/div>\r\n                                        \u003cdiv className=\"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700\">\r\n                                            \u003cdiv className=\"text-2xl mb-2\">ðŸ”¬\u003c/div>\r\n                                            \u003ch3 className=\"font-medium text-gray-800 dark:text-white text-sm\">æ·±åº¦ç ”ç©¶\u003c/h3>\r\n                                            \u003cp className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">å¤šæºæ£€ç´¢ã€èšç±»åˆ†æž\u003c/p>\r\n                                        \u003c/div>\r\n                                        \u003cdiv className=\"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700\">\r\n                                            \u003cdiv className=\"text-2xl mb-2\">ðŸ§ª\u003c/div>\r\n                                            \u003ch3 className=\"font-medium text-gray-800 dark:text-white text-sm\">è®°å½•å®žéªŒ\u003c/h3>\r\n                                            \u003cp className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">è‡ªåŠ¨è§£æžå®žéªŒç»“æžœ\u003c/p>\r\n                                        \u003c/div>\r\n                                    \u003c/div>\r\n\r\n                                    \u003cdiv className=\"text-left bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700\">\r\n                                        \u003cp className=\"font-medium text-gray-800 dark:text-white mb-3 text-sm\">ðŸ’¡ å¿«é€Ÿå¼€å§‹\u003c/p>\r\n                                        \u003cdiv className=\"space-y-2\">\r\n                                            \u003cbutton\r\n                                                onClick={() => handleInputChange('æœç´¢Transformerç›¸å…³çš„æœ€æ–°è®ºæ–‡')}\r\n                                                className=\"w-full text-left px-3 py-2 text-sm rounded-lg bg-gray-50 dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 transition-colors\"\r\n                                            >\r\n                                                ðŸ” æœç´¢Transformerç›¸å…³çš„æœ€æ–°è®ºæ–‡\r\n                                            \u003c/button>\r\n                                            \u003cbutton\r\n                                                onClick={() => handleInputChange('/å®žéªŒ BERTåœ¨SST-2ä¸Šå‡†ç¡®çŽ‡92.3%')}\r\n                                                className=\"w-full text-left px-3 py-2 text-sm rounded-lg bg-gray-50 dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 transition-colors\"\r\n                                            >\r\n                                                ðŸ§ª è®°å½•å®žéªŒï¼šBERTåœ¨SST-2ä¸Šå‡†ç¡®çŽ‡92.3%\r\n                                            \u003c/button>\r\n                                            \u003cbutton\r\n                                                onClick={() => handleInputChange('/æ—¥ç¨‹ æ˜Žå¤©ä¸‹åˆ3ç‚¹ç»„ä¼š')}\r\n                                                className=\"w-full text-left px-3 py-2 text-sm rounded-lg bg-gray-50 dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 transition-colors\"\r\n                                            >\r\n                                                ðŸ“… æ·»åŠ æ—¥ç¨‹ï¼šæ˜Žå¤©ä¸‹åˆ3ç‚¹ç»„ä¼š\r\n                                            \u003c/button>\r\n                                            \u003cbutton\r\n                                                onClick={() => handleInputChange('/æŸ¥è¯¢ æœ€è¿‘çš„å®žéªŒè®°å½•')}\r\n                                                className=\"w-full text-left px-3 py-2 text-sm rounded-lg bg-gray-50 dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 transition-colors\"\r\n                                            >\r\n                                                ðŸ“‹ æŸ¥è¯¢æœ€è¿‘çš„å®žéªŒè®°å½•\r\n                                            \u003c/button>\r\n                                        \u003c/div>\r\n                                    \u003c/div>\r\n                                \u003c/div>\r\n                            \u003c/div>\r\n                        )}\r\n\r\n                        {chatMode === 'planning' && (\r\n                            \u003cdiv className=\"px-4 mb-4\">\r\n                                {planningProgress && planningLoading && (\r\n                                    \u003cdiv className=\"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-200 dark:border-blue-800 mb-4\">\r\n                                        \u003cdiv className=\"flex items-center justify-between mb-2\">\r\n                                            \u003cspan className=\"font-medium text-blue-700 dark:text-blue-300\">\r\n                                                {(() => {\r\n                                                    const labels: Record\u003cstring, string> = {\r\n                                                        'planning': 'ðŸ“‹ è§„åˆ’ä»»åŠ¡',\r\n                                                        'executing': 'âš¡ æ‰§è¡Œä¸­',\r\n                                                        'completed': 'âœ… å®Œæˆ',\r\n                                                        'error': 'âŒ é”™è¯¯'\r\n                                                    }\r\n                                                    return labels[planningProgress.state] || planningProgress.state\r\n                                                })()}\r\n                                            \u003c/span>\r\n                                            \u003cspan className=\"text-sm text-blue-600 dark:text-blue-400\">\r\n                                                {planningProgress.progress}%\r\n                                            \u003c/span>\r\n                                        \u003c/div>\r\n                                        \u003cdiv className=\"w-full bg-blue-200 dark:bg-blue-800 rounded-full h-2\">\r\n                                            \u003cdiv\r\n                                                className=\"bg-blue-500 h-2 rounded-full transition-all duration-300\"\r\n                                                style={{ width: `${planningProgress.progress}%` }}\r\n                                            />\r\n                                        \u003c/div>\r\n                                        \u003cp className=\"text-sm text-blue-600 dark:text-blue-400 mt-2\">\r\n                                            {planningProgress.task}\r\n                                        \u003c/p>\r\n                                    \u003c/div>\r\n                                )}\r\n\r\n                                {planningError && (\r\n                                    \u003cdiv className=\"bg-red-50 dark:bg-red-900/20 p-4 rounded-lg border border-red-200 dark:border-red-800 mb-4 text-red-700 dark:text-red-300\">\r\n                                        âŒ {planningError}\r\n                                    \u003c/div>\r\n                                )}\r\n\r\n                                {planTasks.length > 0 && (\r\n                                    \u003cdiv className=\"bg-gray-800 dark:bg-gray-900 rounded-lg p-4 mb-4\">\r\n                                        \u003cdiv className=\"flex items-center justify-between mb-4\">\r\n                                            \u003ch3 className=\"text-lg font-bold text-white\">\r\n                                                ðŸ“‹ ä»»åŠ¡æ‰§è¡Œ\r\n                                            \u003c/h3>\r\n                                            \u003cspan className=\"text-gray-400 text-sm\">\r\n                                                {planTasks.filter(t => t.status === 'completed').length}/{planTasks.length} å·²å®Œæˆ\r\n                                            \u003c/span>\r\n                                        \u003c/div>\r\n                                        \u003cdiv className=\"space-y-3\">\r\n                                            {planTasks.map((task, idx) => {\r\n                                                const getStatusIcon = (status: string) => {\r\n                                                    switch (status) {\r\n                                                        case 'pending': return 'â­•';\r\n                                                        case 'in_progress': return 'ðŸ”„';\r\n                                                        case 'completed': return 'âœ…';\r\n                                                        case 'failed': return 'âŒ';\r\n                                                        default: return 'â­•';\r\n                                                    }\r\n                                                }\r\n                                                return (\r\n                                                    \u003cdiv\r\n                                                        key={task.task_id}\r\n                                                        className={`flex items-center gap-3 p-3 rounded-lg ${task.status === 'completed'\r\n                                                            ? 'bg-green-900/30 border border-green-700'\r\n                                                            : task.status === 'in_progress'\r\n                                                                ? 'bg-yellow-900/30 border border-yellow-700'\r\n                                                                : 'bg-gray-700 border border-gray-600'\r\n                                                            }`}\r\n                                                    >\r\n                                                        \u003cspan className=\"text-xl\">{getStatusIcon(task.status)}\u003c/span>\r\n                                                        \u003cdiv className=\"flex-1\">\r\n                                                            \u003ch4 className={`font-medium ${task.status === 'completed'\r\n                                                                ? 'text-green-300'\r\n                                                                : task.status === 'in_progress'\r\n                                                                    ? 'text-yellow-300'\r\n                                                                    : 'text-gray-300'\r\n                                                                }`}>\r\n                                                                {task.name}\r\n                                                            \u003c/h4>\r\n                                                        \u003c/div>\r\n                                                    \u003c/div>\r\n                                                )\r\n                                            })}\r\n                                        \u003c/div>\r\n                                    \u003c/div>\r\n                                )}\r\n                            \u003c/div>\r\n                        )}\r\n\r\n                        {messages.map((message) => (\r\n                            \u003cdiv key={message.id} className={`flex ${message.sender === 'user' ? 'justify-end' : 'justify-start'} px-4`}>\r\n                                \u003cdiv className={`message-bubble ${message.sender === 'user' ? 'message-user' : 'message-agent'} max-w-[85%] my-2`}>\r\n                                    {message.sender === 'user' ? (\r\n                                        \u003cp>{message.content}\u003c/p>\r\n                                    ) : (\r\n                                        \u003c>\r\n                                            {message.steps && message.steps.length > 0 && (\r\n                                                \u003cdiv className=\"mb-3\">\r\n                                                    \u003cp className=\"text-xs text-gray-500 dark:text-gray-400 mb-2 font-medium\">\r\n                                                        æ€è€ƒè¿‡ç¨‹ï¼š\r\n                                                    \u003c/p>\r\n                                                    {message.steps.map((step, index) => (\r\n                                                        \u003cdiv key={index}>\r\n                                                            \u003cEnhancedStepCard\r\n                                                                step={step}\r\n                                                                status=\"success\"\r\n                                                            />\r\n                                                        \u003c/div>\r\n                                                    ))}\r\n                                                \u003c/div>\r\n                                            )}\r\n                                            \u003cdiv className=\"pt-2 border-t border-gray-200 dark:border-gray-600\">\r\n                                                \u003cp className=\"text-xs text-gray-500 dark:text-gray-400 mb-1\">æœ€ç»ˆç­”æ¡ˆï¼š\u003c/p>\r\n                                                \u003cp className=\"whitespace-pre-wrap\">{message.content}\u003c/p>\r\n                                            \u003c/div>\r\n                                        \u003c/>\r\n                                    )}\r\n                                    \u003cp className=\"text-xs text-gray-400 mt-2 text-right\">\r\n                                        {message.timestamp.toLocaleTimeString()}\r\n                                    \u003c/p>\r\n                                \u003c/div>\r\n                            \u003c/div>\r\n                        ))}\r\n\r\n                        {isProcessing && currentSteps.length > 0 && (\r\n                            \u003cdiv className=\"flex justify-start px-4\">\r\n                                \u003cdiv className=\"message-bubble message-agent max-w-[85%] my-2\">\r\n                                    \u003cdiv className=\"flex items-center gap-2 mb-2\">\r\n                                        \u003cdiv className=\"animate-spin w-4 h-4 border-2 border-primary-500 border-t-transparent rounded-full\">\u003c/div>\r\n                                        \u003cspan className=\"text-sm text-gray-500 dark:text-gray-400\">Agent æ­£åœ¨æ€è€ƒ...\u003c/span>\r\n                                    \u003c/div>\r\n                                    {currentSteps.map((step, index) => (\r\n                                        \u003cEnhancedStepCard\r\n                                            key={index}\r\n                                            step={step}\r\n                                            status={index === currentSteps.length - 1 ? 'running' : 'success'}\r\n                                        />\r\n                                    ))}\r\n                                \u003c/div>\r\n                            \u003c/div>\r\n                        )}\r\n\r\n                        \u003cdiv ref={messagesEndRef} />\r\n                    \u003c/div>\r\n                    ) : activeTab === 'literature' ? (\r\n                    \u003cdiv className=\"h-full overflow-auto p-4\">\r\n                        \u003cLiteratureManager />\r\n                    \u003c/div>\r\n                    ) : activeTab === 'research' ? (\r\n                    \u003cdiv className=\"h-full overflow-auto p-4\">\r\n                        \u003cResearchAssistant />\r\n                    \u003c/div>\r\n                    ) : activeTab === 'review' ? (\r\n                    \u003cdiv className=\"h-full overflow-auto p-4\">\r\n                        \u003cLiteratureReview />\r\n                    \u003c/div>\r\n                    ) : activeTab === 'experiment' ? (\r\n                    \u003cdiv className=\"h-full overflow-auto p-4\">\r\n                        \u003cExperimentManager />\r\n                    \u003c/div>\r\n                    ) : activeTab === 'ppt' ? (\r\n                    \u003cdiv className=\"h-full overflow-auto p-4\">\r\n                        \u003cPPTGenerator />\r\n                    \u003c/div>\r\n                    ) : activeTab === 'visualization' ? (\r\n                    \u003cVisualizationDashboard />\r\n                        ) : null}\r\n                \u003c/main>\r\n\r\n                {activeTab === 'chat' && (\r\n                    \u003cfooter className=\"chat-input-container flex-shrink-0\">\r\n                        \u003cdiv className=\"mb-3 flex gap-2 flex-wrap\">\r\n                            {QUICK_ACTIONS.map(action => (\r\n                                \u003cbutton\r\n                                    key={action.id}\r\n                                    onClick={() => handleQuickAction(action)}\r\n                                    className={`px-3 py-1.5 text-sm rounded-full transition-all ${inputMode === action.mode\r\n                                        ? 'bg-primary-500 text-white shadow-md'\r\n                                        : 'bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600'\r\n                                        }`}\r\n                                >\r\n                                    {action.icon} {action.label}\r\n                                \u003c/button>\r\n                            ))}\r\n                        \u003c/div>\r\n\r\n                        {showModeHint && detectedMode && (\r\n                            \u003cdiv className={`mb-2 px-3 py-2 rounded-lg text-sm flex items-center gap-2 ${detectedMode.mode === 'record'\r\n                                ? 'bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-300 border border-green-200 dark:border-green-800'\r\n                                : detectedMode.mode === 'query'\r\n                                    ? 'bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 border border-blue-200 dark:border-blue-800'\r\n                                    : 'bg-gray-50 dark:bg-gray-800 text-gray-600 dark:text-gray-400 border border-gray-200 dark:border-gray-700'\r\n                                }`}>\r\n                                \u003cspan className=\"text-lg\">\r\n                                    {detectedMode.mode === 'record' ? 'ðŸ“' : detectedMode.mode === 'query' ? 'ðŸ”' : 'ðŸ’¬'}\r\n                                \u003c/span>\r\n                                \u003cspan>{detectedMode.hint}\u003c/span>\r\n                            \u003c/div>\r\n                        )}\r\n\r\n                        \u003cdiv className=\"flex gap-3\">\r\n                            \u003cdiv className=\"flex-1 relative\">\r\n                                \u003cinput\r\n                                    type=\"text\"\r\n                                    value={inputValue}\r\n                                    onChange={(e) => handleInputChange(e.target.value)}\r\n                                    onKeyPress={handleKeyPress}\r\n                                    placeholder={getCurrentPlaceholder()}\r\n                                    className=\"chat-input w-full\"\r\n                                    disabled={!isConnected || isProcessing}\r\n                                />\r\n                            \u003c/div>\r\n                            \u003cbutton\r\n                                onClick={handleSendMessage}\r\n                                disabled={!isConnected || isProcessing || !inputValue.trim()}\r\n                                className=\"send-button\"\r\n                            >\r\n                                {isProcessing ? 'å¤„ç†ä¸­...' : 'å‘é€'}\r\n                            \u003c/button>\r\n                        \u003c/div>\r\n\r\n                        \u003cdiv className=\"mt-2 text-xs text-gray-400 dark:text-gray-500\">\r\n                            ðŸ’¡ æç¤ºï¼šä½¿ç”¨ \u003ccode className=\"px-1 py-0.5 bg-gray-100 dark:bg-gray-700 rounded\">/å®žéªŒ\u003c/code>ã€\u003ccode className=\"px-1 py-0.5 bg-gray-100 dark:bg-gray-700 rounded\">/æ—¥ç¨‹\u003c/code>ã€\u003ccode className=\"px-1 py-0.5 bg-gray-100 dark:bg-gray-700 rounded\">/æŸ¥è¯¢\u003c/code> å¿«é€Ÿåˆ‡æ¢æ¨¡å¼ï¼Œæˆ–ç›´æŽ¥è¾“å…¥å†…å®¹è‡ªåŠ¨è¯†åˆ«\r\n                        \u003c/div>\r\n                    \u003c/footer>\r\n                )}\r\n            \u003c/div>\r\n        \u003c/div>\r\n\r\n            {\r\n        showLoginModal && (\r\n            \u003cLoginModal onClose={() => setShowLoginModal(false)} />\r\n        )\r\n    }\r\n        \u003c/div >\r\n    )\r\n}\r\n\r\nfunction App() {\r\n    return (\r\n        \u003cAuthProvider>\r\n            \u003cAppContent />\r\n        \u003c/AuthProvider>\r\n    )\r\n}\r\n\r\nexport default App","loc":{"line":803,"column":16,"index":39898}}
              try {
                const { ErrorOverlay } = await import("/@vite/client")
                document.body.appendChild(new ErrorOverlay(error))
              } catch {
                const h = (tag, text) => {
                  const el = document.createElement(tag)
                  el.textContent = text
                  return el
                }
                document.body.appendChild(h('h1', 'Internal Server Error'))
                document.body.appendChild(h('h2', error.message))
                document.body.appendChild(h('pre', error.stack))
                document.body.appendChild(h('p', '(Error overlay failed to load)'))
              }
            </script>
          </head>
          <body>
          </body>
        </html>
      