
        <!DOCTYPE html>
        <html lang="en">
          <head>
            <meta charset="UTF-8" />
            <title>Error</title>
            <script type="module">
              const error = {"message":"C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\src\\ResearchAssistant.tsx: Unexpected token (748:5)\n\n  746 |             )}\n  747 |         \u003c/div>\n> 748 |     )\n      |      ^","stack":"    at constructor (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:365:19)\n    at TypeScriptParserMixin.raise (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:6599:19)\n    at TypeScriptParserMixin.unexpected (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:6619:16)\n    at TypeScriptParserMixin.parseExprAtom (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:11442:22)\n    at TypeScriptParserMixin.parseExprAtom (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:4764:20)\n    at TypeScriptParserMixin.parseExprSubscripts (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:11081:23)\n    at TypeScriptParserMixin.parseUpdate (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:11066:21)\n    at TypeScriptParserMixin.parseMaybeUnary (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:11046:23)\n    at TypeScriptParserMixin.parseMaybeUnary (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:9837:18)\n    at TypeScriptParserMixin.parseMaybeUnaryOrPrivate (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:10899:61)\n    at TypeScriptParserMixin.parseExprOps (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:10904:23)\n    at TypeScriptParserMixin.parseMaybeConditional (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:10881:23)\n    at TypeScriptParserMixin.parseMaybeAssign (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:10831:21)\n    at TypeScriptParserMixin.parseMaybeAssign (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:9786:20)\n    at TypeScriptParserMixin.parseExpressionBase (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:10784:23)\n    at C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:10780:39\n    at TypeScriptParserMixin.allowInAnd (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:12421:16)\n    at TypeScriptParserMixin.parseExpression (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:10780:17)\n    at TypeScriptParserMixin.parseStatementContent (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:12895:23)\n    at TypeScriptParserMixin.parseStatementContent (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:9508:18)\n    at TypeScriptParserMixin.parseStatementLike (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:12767:17)\n    at TypeScriptParserMixin.parseStatementListItem (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:12747:17)\n    at TypeScriptParserMixin.parseBlockOrModuleBlockBody (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:13316:61)\n    at TypeScriptParserMixin.parseBlockBody (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:13309:10)\n    at TypeScriptParserMixin.parseBlock (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:13297:10)\n    at TypeScriptParserMixin.parseFunctionBody (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:12100:24)\n    at TypeScriptParserMixin.parseFunctionBodyAndFinish (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:12086:10)\n    at TypeScriptParserMixin.parseFunctionBodyAndFinish (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:9172:18)\n    at C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:13445:12\n    at TypeScriptParserMixin.withSmartMixTopicForbiddingContext (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:12403:14)\n    at TypeScriptParserMixin.parseFunction (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:13444:10)\n    at TypeScriptParserMixin.parseFunctionStatement (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:13125:17)\n    at TypeScriptParserMixin.parseStatementContent (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:12791:21)\n    at TypeScriptParserMixin.parseStatementContent (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:9508:18)\n    at TypeScriptParserMixin.parseStatementLike (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:12767:17)\n    at TypeScriptParserMixin.parseStatementListItem (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:12747:17)\n    at TypeScriptParserMixin.parseExportDeclaration (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:13934:17)\n    at TypeScriptParserMixin.parseExportDeclaration (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:9629:85)\n    at TypeScriptParserMixin.maybeParseExportDeclaration (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:13893:31)\n    at TypeScriptParserMixin.parseExport (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:13812:29)\n    at TypeScriptParserMixin.parseExport (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:9385:20)\n    at TypeScriptParserMixin.parseStatementContent (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:12878:27)\n    at TypeScriptParserMixin.parseStatementContent (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:9508:18)\n    at TypeScriptParserMixin.parseStatementLike (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:12767:17)\n    at TypeScriptParserMixin.parseModuleItem (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:12744:17)\n    at TypeScriptParserMixin.parseBlockOrModuleBlockBody (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:13316:36)\n    at TypeScriptParserMixin.parseBlockBody (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:13309:10)\n    at TypeScriptParserMixin.parseProgram (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:12622:10)\n    at TypeScriptParserMixin.parseTopLevel (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:12612:25)\n    at TypeScriptParserMixin.parse (C:\\Users\\Lin\\Documents\\trae_projects\\AgentPaper\\node_modules\\@babel\\parser\\lib\\index.js:14488:25)","id":"C:/Users/Lin/Documents/trae_projects/AgentPaper/src/ResearchAssistant.tsx","frame":"746|              )}\n747|          \u003c/div>\n748|      )\n   |       ^","plugin":"vite:react-babel","pluginCode":"import { useState, useEffect, useRef } from 'react'\n\ninterface Paper {\n    paper_id: string\n    title: string\n    authors: string[]\n    year: number\n    abstract: string\n    url: string\n    pdf_url: string\n    source: string\n    citation_count: number\n    analysis?: {\n        contributions: string[]\n        methods: string[]\n        limitations: string[]\n        keywords: string[]\n    }\n}\n\ninterface Cluster {\n    name: string\n    papers: Paper[]\n    paper_count: number\n    keywords: string[]\n}\n\ninterface CrossPoint {\n    name: string\n    description: string\n    related_clusters: string[]\n    potential_methods: string[]\n}\n\ninterface ReportSection {\n    title: string\n    content: string\n    key_findings?: Array\u003c{ finding: string; paper: string; paper_id: string }>\n    references?: Array\u003c{ title: string; year: number }>\n}\n\ninterface ResearchResult {\n    success: boolean\n    topic: string\n    papers: Paper[]\n    clusters: Cluster[]\n    cross_points: CrossPoint[]\n    report: {\n        title: string\n        sections: ReportSection[]\n    }\n}\n\ninterface Progress {\n    state: string\n    progress: number\n    task: string\n}\n\ninterface Step {\n    type: 'thought' | 'action' | 'observation'\n    content: string\n    iteration: number\n    timestamp?: string\n}\n\ninterface TaskStep {\n    step_type: 'thought' | 'action' | 'observation'\n    content: string\n    timestamp: string\n}\n\ninterface ResearchTask {\n    task_id: string\n    name: string\n    description: string\n    status: 'pending' | 'in_progress' | 'completed' | 'failed'\n    steps?: TaskStep[]\n    start_time?: string\n    end_time?: string\n}\n\nexport function ResearchAssistant() {\n    const [topic, setTopic] = useState('')\n    const [years, setYears] = useState(2)\n    const [maxPapers, setMaxPapers] = useState(30)\n    const [loading, setLoading] = useState(false)\n    const [progress, setProgress] = useState\u003cProgress | null>(null)\n    const [steps, setSteps] = useState\u003cStep[]>([])\n    const [result, setResult] = useState\u003cResearchResult | null>(null)\n    const [error, setError] = useState\u003cstring | null>(null)\n    const [tasks, setTasks] = useState\u003cResearchTask[]>([])\n    const [expandedTasks, setExpandedTasks] = useState\u003cSet\u003cstring>>(new Set())\n\n    const [selectedPaper, setSelectedPaper] = useState\u003cPaper | null>(null)\n    const [pdfUrl, setPdfUrl] = useState\u003cstring | null>(null)\n\n    const wsRef = useRef\u003cWebSocket | null>(null)\n\n    useEffect(() => {\n        return () => {\n            if (wsRef.current) {\n                wsRef.current.close()\n            }\n        }\n    }, [])\n\n    const toggleTaskExpand = (taskId: string) => {\n        setExpandedTasks(prev => {\n            const newSet = new Set(prev)\n            if (newSet.has(taskId)) {\n                newSet.delete(taskId)\n            } else {\n                newSet.add(taskId)\n            }\n            return newSet\n        })\n    }\n\n    const downloadReportAsText = (result: ResearchResult) => {\n        let text = `${result.report?.title || 'ç ”ç©¶æŠ¥å‘Š'}\\n\\n`\n\n        result.report?.sections?.forEach(section => {\n            text += `\\n${section.title}\\n${'='.repeat(section.title.length)}\\n`\n            text += `${section.content}\\n`\n\n            if (section.key_findings && section.key_findings.length > 0) {\n                text += '\\nä¸»è¦å‘çŽ°:\\n'\n                section.key_findings.forEach(finding => {\n                    text += `  - ${finding.finding} [${finding.paper}]\\n`\n                })\n            }\n        })\n\n        const blob = new Blob([text], { type: 'text/plain;charset=utf-8' })\n        const url = URL.createObjectURL(blob)\n        const a = document.createElement('a')\n        a.href = url\n        a.download = `${result.topic || 'research_report'}.txt`\n        document.body.appendChild(a)\n        a.click()\n        document.body.removeChild(a)\n        URL.revokeObjectURL(url)\n    }\n\n    const downloadReportAsMarkdown = (result: ResearchResult) => {\n        let md = `# ${result.report?.title || 'ç ”ç©¶æŠ¥å‘Š'}\\n\\n`\n\n        result.report?.sections?.forEach((section, idx) => {\n            md += `\\n## ${section.title}\\n\\n`\n            md += `${section.content}\\n`\n\n            if (section.key_findings && section.key_findings.length > 0) {\n                md += '\\n### ä¸»è¦å‘çŽ°\\n\\n'\n                section.key_findings.forEach(finding => {\n                    md += `- ${finding.finding} [${finding.paper}]\\n`\n                })\n            }\n        })\n\n        md += '\\n---\\n\\n## å‚è€ƒæ–‡çŒ®\\n\\n'\n        result.papers?.slice(0, 20).forEach((paper, idx) => {\n            md += `${idx + 1}. ${paper.title}. ${paper.authors?.join(', ')}. (${paper.year}). ${paper.source}.\\n`\n        })\n\n        const blob = new Blob([md], { type: 'text/markdown;charset=utf-8' })\n        const url = URL.createObjectURL(blob)\n        const a = document.createElement('a')\n        a.href = url\n        a.download = `${result.topic || 'research_report'}.md`\n        document.body.appendChild(a)\n        a.click()\n        document.body.removeChild(a)\n        URL.revokeObjectURL(url)\n    }\n\n    const downloadReportAsHTML = (result: ResearchResult) => {\n        let html = `\u003c!DOCTYPE html>\n\u003chtml>\n\u003chead>\n    \u003cmeta charset=\"UTF-8\">\n    \u003ctitle>${result.report?.title || 'ç ”ç©¶æŠ¥å‘Š'}\u003c/title>\n    \u003cstyle>\n        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }\n        h1 { color: #1a5fb4; border-bottom: 2px solid #1a5fb4; padding-bottom: 10px; }\n        h2 { color: #2c3e50; margin-top: 30px; }\n        h3 { color: #34495e; }\n        .finding { background: #f8f9fa; padding: 10px; border-left: 4px solid #1a5fb4; margin: 10px 0; }\n        .reference { font-size: 0.9em; color: #666; margin: 5px 0; }\n    \u003c/style>\n\u003c/head>\n\u003cbody>\n    \u003ch1>${result.report?.title || 'ç ”ç©¶æŠ¥å‘Š'}\u003c/h1>`\n\n        result.report?.sections?.forEach(section => {\n            html += `\n    \u003ch2>${section.title}\u003c/h2>\n    \u003cp>${section.content.replace(/\\n/g, '\u003cbr>')}\u003c/p>`\n\n            if (section.key_findings && section.key_findings.length > 0) {\n                html += `\n    \u003ch3>ä¸»è¦å‘çŽ°\u003c/h3>`\n                section.key_findings.forEach(finding => {\n                    html += `\n    \u003cdiv class=\"finding\">${finding.finding} \u003cspan style=\"color: #1a5fb4;\">[${finding.paper}]\u003c/span>\u003c/div>`\n                })\n            }\n        })\n\n        html += `\n    \u003ch2>å‚è€ƒæ–‡çŒ®\u003c/h2>`\n        result.papers?.slice(0, 20).forEach((paper, idx) => {\n            html += `\n    \u003cdiv class=\"reference\">${idx + 1}. ${paper.title}. ${paper.authors?.join(', ')}. (${paper.year}). ${paper.source}.\u003c/div>`\n        })\n\n        html += `\n\u003c/body>\n\u003c/html>`\n\n        const blob = new Blob([html], { type: 'text/html;charset=utf-8' })\n        const url = URL.createObjectURL(blob)\n        const a = document.createElement('a')\n        a.href = url\n        a.download = `${result.topic || 'research_report'}.html`\n        document.body.appendChild(a)\n        a.click()\n        document.body.removeChild(a)\n        URL.revokeObjectURL(url)\n    }\n\n    const startResearch = async () => {\n        if (!topic.trim()) return\n\n        setLoading(true)\n        setError(null)\n        setResult(null)\n        setSteps([])\n        setTasks([])\n        setExpandedTasks(new Set())\n        setProgress({ state: 'searching', progress: 0, task: 'æ­£åœ¨åˆå§‹åŒ–...' })\n\n        try {\n            const wsUrl = 'ws://localhost:8000/ws/research'\n            console.log('Connecting to:', wsUrl)\n\n            const ws = new WebSocket(wsUrl)\n            wsRef.current = ws\n\n            ws.onopen = () => {\n                console.log('WebSocket connected')\n                ws.send(JSON.stringify({\n                    type: 'start_research',\n                    topic: topic.trim(),\n                    years,\n                    max_papers: maxPapers\n                }))\n            }\n\n            ws.onmessage = (event) => {\n                const data = JSON.parse(event.data)\n                if (data.type === 'progress') {\n                    setProgress(data)\n                } else if (data.type === 'step') {\n                    setSteps(prev => [...prev, {\n                        type: data.step_type,\n                        content: data.content,\n                        iteration: prev.length + 1,\n                        timestamp: new Date().toISOString()\n                    }])\n                } else if (data.type === 'task_list') {\n                    setTasks(data.tasks)\n                    setSteps(prev => [...prev, {\n                        type: 'thought',\n                        content: 'å·²è§„åˆ’ç ”ç©¶ä»»åŠ¡åˆ—è¡¨',\n                        iteration: prev.length + 1,\n                        timestamp: new Date().toISOString()\n                    }])\n                } else if (data.type === 'task_update') {\n                    setTasks(prev => prev.map(task =>\n                        task.task_id === data.task_id\n                            ? { ...task, status: data.status }\n                            : task\n                    ))\n                } else if (data.type === 'task_step') {\n                    setTasks(prev => prev.map(task => {\n                        if (task.task_id === data.task_id) {\n                            return {\n                                ...task,\n                                steps: [...(task.steps || []), {\n                                    step_type: data.step_type,\n                                    content: data.content,\n                                    timestamp: data.timestamp\n                                }]\n                            }\n                        }\n                        return task\n                    }))\n                } else if (data.type === 'complete') {\n                    setResult(data.result)\n                    setSteps(prev => [...prev, {\n                        type: 'thought',\n                        content: 'ç ”ç©¶å®Œæˆï¼',\n                        iteration: prev.length + 1,\n                        timestamp: new Date().toISOString()\n                    }])\n                    setLoading(false)\n                    ws.close()\n                } else if (data.type === 'error') {\n                    setError(data.error)\n                    setSteps(prev => [...prev, {\n                        type: 'observation',\n                        content: `é”™è¯¯: ${data.error}`,\n                        iteration: prev.length + 1,\n                        timestamp: new Date().toISOString()\n                    }])\n                    setLoading(false)\n                    ws.close()\n                }\n            }\n\n            ws.onerror = (event) => {\n                console.error('WebSocket error:', event)\n                setError('WebSocketè¿žæŽ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥åŽç«¯æœåŠ¡æ˜¯å¦å¯åŠ¨')\n                setLoading(false)\n            }\n\n            ws.onclose = (event) => {\n                console.log('WebSocket closed:', event.code, event.reason)\n            }\n\n        } catch (e: any) {\n            console.error('Error:', e)\n            setError(e.message || 'è¿žæŽ¥é”™è¯¯')\n            setLoading(false)\n        }\n    }\n\n    const openPdf = (paper: Paper) => {\n        if (paper.pdf_url) {\n            setPdfUrl(paper.pdf_url)\n            setSelectedPaper(paper)\n        } else if (paper.url) {\n            window.open(paper.url, '_blank')\n        }\n    }\n\n    const getStateLabel = (state: string) => {\n        const labels: Record\u003cstring, string> = {\n            'planning': 'ðŸ“‹ è§„åˆ’ä»»åŠ¡',\n            'searching': 'ðŸ” æ£€ç´¢æ–‡çŒ®',\n            'analyzing': 'ðŸ“Š åˆ†æžè®ºæ–‡',\n            'clustering': 'ðŸ—‚ï¸ èšç±»åˆ†æž',\n            'synthesizing': 'ðŸ”— è¯†åˆ«äº¤å‰ç‚¹',\n            'generating_report': 'ðŸ“ ç”ŸæˆæŠ¥å‘Š',\n            'completed': 'âœ… å®Œæˆ',\n            'error': 'âŒ é”™è¯¯'\n        }\n        return labels[state] || state\n    }\n\n    const renderPapers = (papers: Paper[]) => (\n        \u003cdiv className=\"grid grid-cols-1 md:grid-cols-2 gap-3 mt-4\">\n            {papers.map((paper, idx) => (\n                \u003cdiv\n                    key={paper.paper_id || idx}\n                    className=\"bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 hover:shadow-md transition-shadow cursor-pointer\"\n                    onClick={() => setSelectedPaper(paper)}\n                >\n                    \u003cdiv className=\"flex items-start justify-between\">\n                        \u003cdiv className=\"flex-1\">\n                            \u003ch3 className=\"font-medium text-gray-800 dark:text-white mb-1 text-sm\">\n                                {paper.title}\n                            \u003c/h3>\n                            \u003cp className=\"text-xs text-gray-500 dark:text-gray-400 mb-2\">\n                                {paper.authors?.slice(0, 3).join(', ')}\n                                {paper.authors && paper.authors.length > 3 && ' et al.'}\n                                {' Â· '}{paper.year}{' Â· '}\n                                \u003cspan className=\"text-blue-500\">{paper.source}\u003c/span>\n                            \u003c/p>\n                            \u003cp className=\"text-xs text-gray-600 dark:text-gray-400 line-clamp-2\">\n                                {paper.abstract?.substring(0, 150)}...\n                            \u003c/p>\n                        \u003c/div>\n                        \u003cdiv className=\"text-right ml-3\">\n                            \u003cdiv className=\"text-lg font-bold text-blue-500\">\n                                {paper.citation_count}\n                            \u003c/div>\n                            \u003cdiv className=\"text-xs text-gray-400\">å¼•ç”¨\u003c/div>\n                            {paper.pdf_url && (\n                                \u003cbutton\n                                    onClick={(e) => { e.stopPropagation(); openPdf(paper); }}\n                                    className=\"mt-2 px-2 py-1 bg-red-100 dark:bg-red-900 text-red-600 dark:text-red-300 rounded text-xs hover:bg-red-200 dark:hover:bg-red-800\"\n                                >\n                                    PDF\n                                \u003c/button>\n                            )}\n                        \u003c/div>\n                    \u003c/div>\n                \u003c/div>\n            ))}\n        \u003c/div>\n    )\n\n    return (\n        \u003cdiv className=\"h-full flex flex-col\">\n            \u003cdiv className=\"mb-4\">\n                \u003ch2 className=\"text-xl font-bold text-gray-800 dark:text-white mb-2\">\n                    ðŸ”¬ æ·±åº¦ç ”ç©¶åŠ©æ‰‹\n                \u003c/h2>\n                \u003cp className=\"text-sm text-gray-600 dark:text-gray-400\">\n                    å…¨æµç¨‹æ‰§è¡Œï¼šä»»åŠ¡è§„åˆ’ â†’ å¤šæºæ£€ç´¢ â†’ è®ºæ–‡åˆ†æž â†’ ä¸»é¢˜èšç±» â†’ è¯†åˆ«äº¤å‰ç‚¹ â†’ ç”ŸæˆæŠ¥å‘Š\n                \u003c/p>\n            \u003c/div>\n\n            \u003cdiv className=\"bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 mb-4\">\n                \u003cdiv className=\"grid grid-cols-1 md:grid-cols-4 gap-3 mb-3\">\n                    \u003cdiv className=\"md:col-span-2\">\n                        \u003clabel className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n                            ç ”ç©¶ä¸»é¢˜\n                        \u003c/label>\n                        \u003cinput\n                            type=\"text\"\n                            value={topic}\n                            onChange={(e) => setTopic(e.target.value)}\n                            placeholder=\"å¦‚ï¼šAI for Climate Modeling\"\n                            className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n                            disabled={loading}\n                        />\n                    \u003c/div>\n                    \u003cdiv>\n                        \u003clabel className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n                            å¹´é™\n                        \u003c/label>\n                        \u003cselect\n                            value={years}\n                            onChange={(e) => setYears(Number(e.target.value))}\n                            className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n                            disabled={loading}\n                        >\n                            \u003coption value={1}>æœ€è¿‘1å¹´\u003c/option>\n                            \u003coption value={2}>æœ€è¿‘2å¹´\u003c/option>\n                            \u003coption value={3}>æœ€è¿‘3å¹´\u003c/option>\n                            \u003coption value={5}>æœ€è¿‘5å¹´\u003c/option>\n                        \u003c/select>\n                    \u003c/div>\n                    \u003cdiv>\n                        \u003clabel className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n                            è®ºæ–‡æ•°é‡\n                        \u003c/label>\n                        \u003cselect\n                            value={maxPapers}\n                            onChange={(e) => setMaxPapers(Number(e.target.value))}\n                            className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n                            disabled={loading}\n                        >\n                            \u003coption value={20}>20ç¯‡\u003c/option>\n                            \u003coption value={30}>30ç¯‡\u003c/option>\n                            \u003coption value={50}>50ç¯‡\u003c/option>\n                            \u003coption value={80}>80ç¯‡\u003c/option>\n                        \u003c/select>\n                    \u003c/div>\n                \u003c/div>\n\n                \u003cbutton\n                    onClick={startResearch}\n                    disabled={loading || !topic.trim()}\n                    className=\"w-full py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium\"\n                >\n                    {loading ? 'ç ”ç©¶è¿›è¡Œä¸­...' : 'ðŸš€ å¼€å§‹æ·±åº¦ç ”ç©¶'}\n                \u003c/button>\n            \u003c/div>\n\n            {progress && loading && (\n                \u003cdiv className=\"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-200 dark:border-blue-800 mb-4\">\n                    \u003cdiv className=\"flex items-center justify-between mb-2\">\n                        \u003cspan className=\"font-medium text-blue-700 dark:text-blue-300\">\n                            {getStateLabel(progress.state)}\n                        \u003c/span>\n                        \u003cspan className=\"text-sm text-blue-600 dark:text-blue-400\">\n                            {progress.progress}%\n                        \u003c/span>\n                    \u003c/div>\n                    \u003cdiv className=\"w-full bg-blue-200 dark:bg-blue-800 rounded-full h-2\">\n                        \u003cdiv\n                            className=\"bg-blue-500 h-2 rounded-full transition-all duration-300\"\n                            style={{ width: `${progress.progress}%` }}\n                        />\n                    \u003c/div>\n                    \u003cp className=\"text-sm text-blue-600 dark:text-blue-400 mt-2\">\n                        {progress.task}\n                    \u003c/p>\n                \u003c/div>\n            )}\n\n            {error && (\n                \u003cdiv className=\"bg-red-50 dark:bg-red-900/20 p-4 rounded-lg border border-red-200 dark:border-red-800 mb-4 text-red-700 dark:text-red-300\">\n                    âŒ {error}\n                \u003c/div>\n            )}\n\n            \u003cdiv className=\"flex-1 overflow-auto\">\n                \u003cdiv className=\"space-y-4\">\n                    {tasks.map((task, idx) => {\n                        const isExpanded = expandedTasks.has(task.task_id) || task.status === 'in_progress' || task.status === 'completed'\n                        const getStatusIcon = (status: string) => {\n                            switch (status) {\n                                case 'pending': return 'â¸ï¸'\n                                case 'in_progress': return 'ðŸ”„'\n                                case 'completed': return 'âœ…'\n                                case 'failed': return 'âŒ'\n                                default: return 'â¸ï¸'\n                            }\n                        }\n                        const getStatusColor = (status: string) => {\n                            switch (status) {\n                                case 'pending': return 'border-gray-300 bg-gray-50 dark:bg-gray-700 dark:border-gray-600'\n                                case 'in_progress': return 'border-yellow-300 bg-yellow-50 dark:bg-yellow-900/20 dark:border-yellow-700'\n                                case 'completed': return 'border-green-300 bg-green-50 dark:bg-green-900/20 dark:border-green-700'\n                                case 'failed': return 'border-red-300 bg-red-50 dark:bg-red-900/20 dark:border-red-700'\n                                default: return 'border-gray-300 bg-gray-50 dark:bg-gray-700 dark:border-gray-600'\n                            }\n                        }\n                        return (\n                            \u003cdiv key={task.task_id} className={`mb-4 border rounded-lg ${getStatusColor(task.status)}`}>\n                                \u003cdiv\n                                    className=\"p-4 cursor-pointer hover:bg-opacity-90 flex items-center justify-between\"\n                                    onClick={() => toggleTaskExpand(task.task_id)}\n                                >\n                                    \u003cdiv className=\"flex items-center gap-3 flex-1\">\n                                        \u003cspan className=\"text-xl\">{getStatusIcon(task.status)}\u003c/span>\n                                        \u003cdiv className=\"flex-1\">\n                                            \u003ch4 className=\"font-medium text-gray-800 dark:text-white text-lg\">\n                                                æ­¥éª¤ {idx + 1}: {task.name}\n                                            \u003c/h4>\n                                            \u003cp className=\"text-sm text-gray-600 dark:text-gray-400 mt-1\">\n                                                {task.description}\n                                            \u003c/p>\n                                        \u003c/div>\n                                    \u003c/div>\n                                    \u003cspan className=\"text-gray-400 text-sm\">\n                                        {isExpanded ? 'æ”¶èµ·' : 'å±•å¼€'} {isExpanded ? 'â–²' : 'â–¼'}\n                                    \u003c/span>\n                                \u003c/div>\n\n                                {isExpanded && (\n                                    \u003cdiv className=\"border-t border-gray-200 dark:border-gray-700 p-4 bg-white dark:bg-gray-800\">\n                                        {task.steps && task.steps.length > 0 && (\n                                            \u003cdiv>\n                                                \u003ch5 className=\"font-medium text-gray-700 dark:text-gray-300 mb-3\">\n                                                    ðŸ“ æ€è€ƒé“¾\n                                                \u003c/h5>\n                                                \u003cdiv className=\"space-y-3\">\n                                                    {task.steps.map((step, stepIdx) => (\n                                                        \u003cdiv\n                                                            key={stepIdx}\n                                                            className={`p-4 rounded-lg border ${step.step_type === 'thought'\n                                                                ? 'bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800'\n                                                                : step.step_type === 'action'\n                                                                    ? 'bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800'\n                                                                    : 'bg-gray-50 dark:bg-gray-700 border-gray-200 dark:border-gray-600'\n                                                                }`}\n                                                        >\n                                                            \u003cdiv className=\"flex items-center gap-2 mb-2\">\n                                                                \u003cspan className=\"text-sm font-medium px-3 py-1 rounded-full\">\n                                                                    {step.step_type === 'thought' ? 'ðŸ’­ æ€è€ƒ' : step.step_type === 'action' ? 'âš¡ è¡ŒåŠ¨' : 'ðŸ‘ï¸ è§‚å¯Ÿ'}\n                                                                \u003c/span>\n                                                                \u003cspan className=\"text-xs text-gray-500 dark:text-gray-400\">\n                                                                    æ­¥éª¤ {stepIdx + 1}\n                                                                \u003c/span>\n                                                            \u003c/div>\n                                                            \u003cp className=\"text-gray-700 dark:text-gray-300 whitespace-pre-wrap\">\n                                                                {step.content}\n                                                            \u003c/p>\n                                                        \u003c/div>\n                                                    ))}\n                                                \u003c/div>\n                                            \u003c/div>\n                                        )}\n\n                                        {task.status === 'completed' && task.task_id === 'search' && result && (\n                                            \u003cdiv className=\"mt-4\">\n                                                \u003ch5 className=\"font-medium text-gray-700 dark:text-gray-300 mb-3\">\n                                                    ðŸ“„ æ£€ç´¢ç»“æžœ ({result.papers.length} ç¯‡è®ºæ–‡)\n                                                \u003c/h5>\n                                                {renderPapers(result.papers.slice(0, 8))}\n                                                {result.papers.length > 8 && (\n                                                    \u003cp className=\"text-center text-gray-500 dark:text-gray-400 mt-2 text-sm\">\n                                                        ... è¿˜æœ‰ {result.papers.length - 8} ç¯‡è®ºæ–‡\n                                                    \u003c/p>\n                                                )}\n                                            \u003c/div>\n                                        )}\n\n                                        {task.status === 'completed' && task.task_id === 'cluster' && result && (\n                                            \u003cdiv className=\"mt-4\">\n                                                \u003ch5 className=\"font-medium text-gray-700 dark:text-gray-300 mb-3\">\n                                                    ðŸ—‚ï¸ ç ”ç©¶æ–¹å‘ ({result.clusters.length} ä¸ª)\n                                                \u003c/h5>\n                                                \u003cdiv className=\"space-y-4\">\n                                                    {result.clusters.map((cluster, clusterIdx) => (\n                                                        \u003cdiv key={clusterIdx} className=\"bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700\">\n                                                            \u003cdiv className=\"flex items-center justify-between mb-3\">\n                                                                \u003ch6 className=\"font-bold text-gray-800 dark:text-white\">\n                                                                    {cluster.name}\n                                                                \u003c/h6>\n                                                                \u003cspan className=\"px-3 py-1 bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 rounded-full text-sm\">\n                                                                    {cluster.paper_count} ç¯‡è®ºæ–‡\n                                                                \u003c/span>\n                                                            \u003c/div>\n                                                            \u003cdiv className=\"flex flex-wrap gap-2 mb-3\">\n                                                                {cluster.keywords?.slice(0, 5).map((kw, i) => (\n                                                                    \u003cspan key={i} className=\"px-2 py-1 bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 rounded text-xs\">\n                                                                        {kw}\n                                                                    \u003c/span>\n                                                                ))}\n                                                            \u003c/div>\n                                                        \u003c/div>\n                                                    ))}\n                                                \u003c/div>\n                                            \u003c/div>\n                                        )}\n\n                                        {task.status === 'completed' && task.task_id === 'synthesis' && result && result.cross_points && result.cross_points.length > 0 && (\n                                            \u003cdiv className=\"mt-4\">\n                                                \u003ch5 className=\"font-medium text-gray-700 dark:text-gray-300 mb-3\">\n                                                    ðŸ”— ç ”ç©¶äº¤å‰ç‚¹ ({result.cross_points.length} ä¸ª)\n                                                \u003c/h5>\n                                                \u003cdiv className=\"bg-gradient-to-r from-purple-50 to-blue-50 dark:from-purple-900/20 dark:to-blue-900/20 p-4 rounded-lg border border-purple-200 dark:border-purple-800\">\n                                                    {result.cross_points.map((cp, cpIdx) => (\n                                                        \u003cdiv key={cpIdx} className=\"mb-3 p-3 bg-white dark:bg-gray-800 rounded-lg last:mb-0\">\n                                                            \u003cdiv className=\"font-medium text-gray-800 dark:text-white mb-1\">\n                                                                {cp.name}\n                                                            \u003c/div>\n                                                            \u003cp className=\"text-sm text-gray-600 dark:text-gray-400\">\n                                                                {cp.description}\n                                                            \u003c/p>\n                                                            \u003cdiv className=\"mt-2 flex flex-wrap gap-1\">\n                                                                {cp.related_clusters?.map((rc, i) => (\n                                                                    \u003cspan key={i} className=\"px-2 py-0.5 bg-purple-100 dark:bg-purple-900 text-purple-700 dark:text-purple-300 rounded text-xs\">\n                                                                        {rc}\n                                                                    \u003c/span>\n                                                                ))}\n                                                            \u003c/div>\n                                                        \u003c/div>\n                                                    ))}\n                                                \u003c/div>\n                                            \u003c/div>\n                                        )}\n                                    \u003c/div>\n                                )}\n                            \u003c/div>\n                        )\n                    })}\n\n                    {result && result.report && (\n                        \u003cdiv className=\"bg-white dark:bg-gray-800 p-6 rounded-lg border border-gray-200 dark:border-gray-700\">\n                            \u003cdiv className=\"flex items-center justify-between mb-4\">\n                                \u003ch2 className=\"text-xl font-bold text-gray-800 dark:text-white\">\n                                    {result.report.title}\n                                \u003c/h2>\n                                \u003cdiv className=\"flex gap-2\">\n                                    \u003cbutton\n                                        onClick={() => downloadReportAsText(result)}\n                                        className=\"px-3 py-1 text-sm bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded hover:bg-gray-200 dark:hover:bg-gray-600\"\n                                    >\n                                        ðŸ“„ ä¸‹è½½ TXT\n                                    \u003c/button>\n                                    \u003cbutton\n                                        onClick={() => downloadReportAsMarkdown(result)}\n                                        className=\"px-3 py-1 text-sm bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded hover:bg-blue-200 dark:hover:bg-blue-900/50\"\n                                    >\n                                        ðŸ“ ä¸‹è½½ MD\n                                    \u003c/button>\n                                    \u003cbutton\n                                        onClick={() => downloadReportAsHTML(result)}\n                                        className=\"px-3 py-1 text-sm bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 rounded hover:bg-green-200 dark:hover:bg-green-900/50\"\n                                    >\n                                        ðŸŒ ä¸‹è½½ HTML\n                                    \u003c/button>\n                                \u003c/div>\n                            \u003c/div>\n\n                            {result.report.sections?.map((section, idx) => (\n                                \u003cdiv key={idx} className=\"mb-6\">\n                                    \u003ch3 className=\"text-lg font-bold text-gray-700 dark:text-gray-200 mb-2 border-b border-gray-200 dark:border-gray-700 pb-1\">\n                                        {section.title}\n                                    \u003c/h3>\n                                    \u003cp className=\"text-gray-600 dark:text-gray-400 whitespace-pre-wrap\">\n                                        {section.content}\n                                    \u003c/p>\n\n                                    {section.key_findings && section.key_findings.length > 0 && (\n                                        \u003cdiv className=\"mt-3 space-y-2\">\n                                            {section.key_findings.map((finding, i) => (\n                                                \u003cdiv key={i} className=\"p-2 bg-gray-50 dark:bg-gray-700 rounded text-sm\">\n                                                    \u003cspan className=\"text-gray-700 dark:text-gray-300\">\n                                                        â€¢ {finding.finding}\n                                                    \u003c/span>\n                                                \u003c/div>\n                                            ))}\n                                        \u003c/div>\n                                    )}\n                                \u003c/div>\n                            ))}\n                        \u003c/div>\n                    )}\n                \u003c/div>\n            \u003c/div>\n\n            {!result && !loading && tasks.length === 0 && (\n                \u003cdiv className=\"flex-1 flex items-center justify-center text-gray-400 dark:text-gray-500\">\n                    \u003cdiv className=\"text-center\">\n                        \u003cdiv className=\"text-6xl mb-4\">ðŸ”¬\u003c/div>\n                        \u003cp className=\"text-lg mb-2\">è¾“å…¥ç ”ç©¶ä¸»é¢˜å¼€å§‹æ·±åº¦è°ƒç ”\u003c/p>\n                        \u003cp className=\"text-sm\">\n                            ç³»ç»Ÿå°†è‡ªåŠ¨æ‰§è¡Œå®Œæ•´ç ”ç©¶æµç¨‹ï¼šä»»åŠ¡è§„åˆ’ â†’ å¤šæºæ£€ç´¢ â†’ è®ºæ–‡åˆ†æž â†’ èšç±»åˆ†æž â†’ è¯†åˆ«äº¤å‰ç‚¹ â†’ ç”ŸæˆæŠ¥å‘Š\n                        \u003c/p>\n                    \u003c/div>\n                \u003c/div>\n            )}\n\n            {pdfUrl && selectedPaper && (\n                \u003cdiv className=\"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4\">\n                    \u003cdiv className=\"bg-white dark:bg-gray-800 rounded-lg w-full max-w-5xl h-5/6 flex flex-col\">\n                        \u003cdiv className=\"flex items-center justify-between p-3 border-b border-gray-200 dark:border-gray-700\">\n                            \u003ch3 className=\"font-medium text-gray-800 dark:text-white truncate\">\n                                {selectedPaper.title}\n                            \u003c/h3>\n                            \u003cbutton\n                                onClick={() => { setPdfUrl(null); setSelectedPaper(null); }}\n                                className=\"px-3 py-1 bg-gray-100 dark:bg-gray-700 rounded hover:bg-gray-200 dark:hover:bg-gray-600\"\n                            >\n                                å…³é—­\n                            \u003c/button>\n                        \u003c/div>\n                        \u003cdiv className=\"flex-1\">\n                            \u003ciframe\n                                src={pdfUrl}\n                                className=\"w-full h-full\"\n                                title=\"PDF Preview\"\n                            />\n                        \u003c/div>\n                    \u003c/div>\n                \u003c/div>\n            )}\n        \u003c/div>\n    )","loc":{"line":748,"column":5,"index":36692}}
              try {
                const { ErrorOverlay } = await import("/@vite/client")
                document.body.appendChild(new ErrorOverlay(error))
              } catch {
                const h = (tag, text) => {
                  const el = document.createElement(tag)
                  el.textContent = text
                  return el
                }
                document.body.appendChild(h('h1', 'Internal Server Error'))
                document.body.appendChild(h('h2', error.message))
                document.body.appendChild(h('pre', error.stack))
                document.body.appendChild(h('p', '(Error overlay failed to load)'))
              }
            </script>
          </head>
          <body>
          </body>
        </html>
      